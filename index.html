<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Segurança do Navegador</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1, h2, h3 {
            color: #333;
        }
        .test-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .test-card {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .test-card h3 {
            margin-top: 0;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
        }
        button:hover {
            background-color: #45a049;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            min-height: 50px;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
        }
        .success {
            color: green;
        }
        .failure {
            color: red;
        }
        .warning {
            color: orange;
        }
        .top-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #333;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        .nav-buttons {
            position: sticky;
            top: 0;
            background-color: #fff;
            padding: 10px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            z-index: 100;
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .category-button {
            background-color: #2196F3;
            margin-right: 10px;
        }
        .refresh-button {
            background-color: #ff9800;
        }
        #summary {
            background-color: #fff;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div class="nav-buttons">
        <div>
            <button class="category-button" onclick="scrollToCategory('dom')">Testes DOM</button>
            <button class="category-button" onclick="scrollToCategory('network')">Testes de Rede</button>
            <button class="category-button" onclick="scrollToCategory('storage')">Testes de Armazenamento</button>
            <button class="category-button" onclick="scrollToCategory('api')">Testes de API</button>
            <button class="category-button" onclick="scrollToCategory('execution')">Testes de Execução</button>
        </div>
        <button class="refresh-button" onclick="location.reload()">Atualizar Página</button>
    </div>

    <h1>Teste de Segurança do Navegador</h1>
    <p>Esta página contém vários testes para verificar se o navegador é realmente à prova de hackers e se é possível escapar da sandbox.</p>
    
    <div id="summary">
        <h2>Resumo dos Testes</h2>
        <p>Total de testes: <span id="total-tests">0</span></p>
        <p>Testes executados: <span id="executed-tests">0</span></p>
        <p>Possíveis vulnerabilidades encontradas: <span id="vulnerabilities-found">0</span></p>
    </div>

    <h2 id="dom">Testes de Manipulação DOM</h2>
    <div class="test-container">
        <div class="test-card">
            <h3>Acesso ao DOM Principal</h3>
            <p>Tenta acessar o DOM principal fora da sandbox.</p>
            <button onclick="testDOMAccess()">Executar Teste</button>
            <div id="dom-access-result" class="result"></div>
        </div>

        <div class="test-card">
            <h3>Injeção de Script</h3>
            <p>Tenta injetar e executar um script no contexto principal.</p>
            <button onclick="testScriptInjection()">Executar Teste</button>
            <div id="script-injection-result" class="result"></div>
        </div>

        <div class="test-card">
            <h3>Modificação de Origem</h3>
            <p>Tenta modificar a origem do documento.</p>
            <button onclick="testOriginModification()">Executar Teste</button>
            <div id="origin-modification-result" class="result"></div>
        </div>

        <div class="test-card">
            <h3>Acesso a Frames Pai</h3>
            <p>Tenta acessar frames pai ou janelas pai.</p>
            <button onclick="testParentFrameAccess()">Executar Teste</button>
            <div id="parent-frame-result" class="result"></div>
        </div>
    </div>

    <h2 id="network">Testes de Rede</h2>
    <div class="test-container">
        <div class="test-card">
            <h3>Requisição para Localhost</h3>
            <p>Tenta fazer uma requisição para localhost.</p>
            <button onclick="testLocalhost()">Executar Teste</button>
            <div id="localhost-result" class="result"></div>
        </div>

        <div class="test-card">
            <h3>Requisição para IP Local</h3>
            <p>Tenta fazer uma requisição para IPs da rede local.</p>
            <button onclick="testLocalIP()">Executar Teste</button>
            <div id="local-ip-result" class="result"></div>
        </div>

        <div class="test-card">
            <h3>WebSocket para Origem Diferente</h3>
            <p>Tenta estabelecer uma conexão WebSocket com uma origem diferente.</p>
            <button onclick="testWebSocket()">Executar Teste</button>
            <div id="websocket-result" class="result"></div>
        </div>

        <div class="test-card">
            <h3>Requisição para Portas Restritas</h3>
            <p>Tenta fazer requisições para portas comumente restritas.</p>
            <button onclick="testRestrictedPorts()">Executar Teste</button>
            <div id="restricted-ports-result" class="result"></div>
        </div>
    </div>

    <h2 id="storage">Testes de Armazenamento</h2>
    <div class="test-container">
        <div class="test-card">
            <h3>Acesso ao Sistema de Arquivos</h3>
            <p>Tenta acessar o sistema de arquivos local.</p>
            <button onclick="testFileSystemAccess()">Executar Teste</button>
            <div id="filesystem-result" class="result"></div>
        </div>

        <div class="test-card">
            <h3>Acesso ao IndexedDB</h3>
            <p>Tenta acessar o IndexedDB para armazenamento persistente.</p>
            <button onclick="testIndexedDB()">Executar Teste</button>
            <div id="indexeddb-result" class="result"></div>
        </div>

        <div class="test-card">
            <h3>Acesso ao localStorage</h3>
            <p>Tenta acessar o localStorage para armazenamento persistente.</p>
            <button onclick="testLocalStorage()">Executar Teste</button>
            <div id="localstorage-result" class="result"></div>
        </div>

        <div class="test-card">
            <h3>Acesso a Cookies</h3>
            <p>Tenta acessar e modificar cookies.</p>
            <button onclick="testCookieAccess()">Executar Teste</button>
            <div id="cookie-result" class="result"></div>
        </div>
    </div>

    <h2 id="api">Testes de API</h2>
    <div class="test-container">
        <div class="test-card">
            <h3>Acesso à Geolocalização</h3>
            <p>Tenta acessar a API de Geolocalização.</p>
            <button onclick="testGeolocation()">Executar Teste</button>
            <div id="geolocation-result" class="result"></div>
        </div>

        <div class="test-card">
            <h3>Acesso à Câmera/Microfone</h3>
            <p>Tenta acessar a câmera e o microfone.</p>
            <button onclick="testMediaDevices()">Executar Teste</button>
            <div id="media-devices-result" class="result"></div>
        </div>

        <div class="test-card">
            <h3>Acesso a Notificações</h3>
            <p>Tenta acessar a API de Notificações.</p>
            <button onclick="testNotifications()">Executar Teste</button>
            <div id="notifications-result" class="result"></div>
        </div>

        <div class="test-card">
            <h3>Acesso ao Bluetooth</h3>
            <p>Tenta acessar a API de Bluetooth.</p>
            <button onclick="testBluetooth()">Executar Teste</button>
            <div id="bluetooth-result" class="result"></div>
        </div>
    </div>

    <h2 id="execution">Testes de Execução de Código</h2>
    <div class="test-container">
        <div class="test-card">
            <h3>Execução de Código Arbitrário</h3>
            <p>Tenta executar código arbitrário fora da sandbox.</p>
            <button onclick="testArbitraryExecution()">Executar Teste</button>
            <div id="arbitrary-execution-result" class="result"></div>
        </div>

        <div class="test-card">
            <h3>Acesso a APIs Nativas</h3>
            <p>Tenta acessar APIs nativas do sistema.</p>
            <button onclick="testNativeAPIs()">Executar Teste</button>
            <div id="native-apis-result" class="result"></div>
        </div>

        <div class="test-card">
            <h3>Execução de WebAssembly</h3>
            <p>Tenta executar código WebAssembly com acesso privilegiado.</p>
            <button onclick="testWebAssembly()">Executar Teste</button>
            <div id="webassembly-result" class="result"></div>
        </div>

        <div class="test-card">
            <h3>Exploração de Service Workers</h3>
            <p>Tenta registrar e explorar Service Workers.</p>
            <button onclick="testServiceWorkers()">Executar Teste</button>
            <div id="service-workers-result" class="result"></div>
        </div>

        <div class="test-card">
            <h3>Exploração de Shared Workers</h3>
            <p>Tenta criar e explorar Shared Workers.</p>
            <button onclick="testSharedWorkers()">Executar Teste</button>
            <div id="shared-workers-result" class="result"></div>
        </div>

        <div class="test-card">
            <h3>Exploração de Web Workers</h3>
            <p>Tenta criar e explorar Web Workers.</p>
            <button onclick="testWebWorkers()">Executar Teste</button>
            <div id="web-workers-result" class="result"></div>
        </div>
    </div>

    <button class="top-button" onclick="scrollToTop()">↑</button>

    <script>
        // Contador de testes
        let totalTests = document.querySelectorAll('.test-card').length;
        let executedTests = 0;
        let vulnerabilitiesFound = 0;
        
        document.getElementById('total-tests').textContent = totalTests;

        // Função para atualizar o resumo
        function updateSummary(isVulnerable) {
            executedTests++;
            document.getElementById('executed-tests').textContent = executedTests;
            
            if (isVulnerable) {
                vulnerabilitiesFound++;
                document.getElementById('vulnerabilities-found').textContent = vulnerabilitiesFound;
            }
        }

        // Função para exibir resultados
        function displayResult(elementId, success, message) {
            const resultElement = document.getElementById(elementId);
            resultElement.innerHTML = message;
            resultElement.className = success ? 'result success' : 'result failure';
            updateSummary(success);
        }

        // Função para exibir resultados com aviso
        function displayWarning(elementId, message) {
            const resultElement = document.getElementById(elementId);
            resultElement.innerHTML = message;
            resultElement.className = 'result warning';
            updateSummary(false);
        }

        // Funções de navegação
        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function scrollToCategory(categoryId) {
            const element = document.getElementById(categoryId);
            element.scrollIntoView({ behavior: 'smooth' });
        }

        // Testes de DOM
        function testDOMAccess() {
            try {
                // Tenta acessar o DOM principal
                const topWindow = window.top;
                const parentWindow = window.parent;
                
                if (topWindow !== window || parentWindow !== window) {
                    displayResult('dom-access-result', true, 'Possível vulnerabilidade: Acesso ao DOM principal detectado!');
                } else {
                    // Tenta acessar propriedades do DOM principal
                    if (topWindow.document.domain) {
                        displayResult('dom-access-result', true, 'Possível vulnerabilidade: Acesso ao domínio do documento principal!');
                    } else {
                        displayResult('dom-access-result', false, 'Sandbox segura: Não foi possível acessar o DOM principal.');
                    }
                }
            } catch (e) {
                displayResult('dom-access-result', false, 'Sandbox segura: ' + e.message);
            }
        }

        function testScriptInjection() {
            try {
                // Tenta injetar um script no DOM principal
                const script = document.createElement('script');
                script.textContent = 'window.scriptInjectionSuccess = true;';
                document.head.appendChild(script);
                
                setTimeout(() => {
                    if (window.scriptInjectionSuccess) {
                        displayResult('script-injection-result', true, 'Possível vulnerabilidade: Script injetado com sucesso!');
                    } else {
                        displayResult('script-injection-result', false, 'Sandbox segura: Não foi possível injetar script com acesso privilegiado.');
                    }
                }, 500);
            } catch (e) {
                displayResult('script-injection-result', false, 'Sandbox segura: ' + e.message);
            }
        }

        function testOriginModification() {
            const originalOrigin = window.location.origin;
            try {
                // Tenta modificar a origem
                Object.defineProperty(window.location, 'origin', {
                    value: 'https://malicious-site.com'
                });
                
                if (window.location.origin !== originalOrigin) {
                    displayResult('origin-modification-result', true, 'Possível vulnerabilidade: Origem modificada com sucesso!');
                } else {
                    displayResult('origin-modification-result', false, 'Sandbox segura: Não foi possível modificar a origem.');
                }
            } catch (e) {
                displayResult('origin-modification-result', false, 'Sandbox segura: ' + e.message);
            }
        }

        function testParentFrameAccess() {
            try {
                // Tenta acessar frames pai
                if (window.parent !== window) {
                    const parentDocument = window.parent.document;
                    displayResult('parent-frame-result', true, 'Possível vulnerabilidade: Acesso ao frame pai detectado!');
                } else if (window.top !== window) {
                    const topDocument = window.top.document;
                    displayResult('parent-frame-result', true, 'Possível vulnerabilidade: Acesso ao frame top detectado!');
                } else {
                    displayResult('parent-frame-result', false, 'Sandbox segura: Não foi possível acessar frames pai.');
                }
            } catch (e) {
                displayResult('parent-frame-result', false, 'Sandbox segura: ' + e.message);
            }
        }

        // Testes de Rede
        function testLocalhost() {
            const resultElement = document.getElementById('localhost-result');
            resultElement.innerHTML = 'Testando...';
            
            fetch('http://localhost:8080')
                .then(response => {
                    displayResult('localhost-result', true, 'Possível vulnerabilidade: Acesso a localhost permitido!');
                })
                .catch(error => {
                    displayResult('localhost-result', false, 'Sandbox segura: Não foi possível acessar localhost. ' + error.message);
                });
        }

        function testLocalIP() {
            const resultElement = document.getElementById('local-ip-result');
            resultElement.innerHTML = 'Testando...';
            
            // Tenta acessar IPs locais comuns
            const ips = ['192.168.1.1', '10.0.0.1', '172.16.0.1'];
            let completedTests = 0;
            let anySuccess = false;
            
            ips.forEach(ip => {
                fetch(`http://${ip}`)
                    .then(response => {
                        anySuccess = true;
                        completedTests++;
                        checkCompletion();
                    })
                    .catch(error => {
                        completedTests++;
                        checkCompletion();
                    });
            });
            
            function checkCompletion() {
                if (completedTests === ips.length) {
                    if (anySuccess) {
                        displayResult('local-ip-result', true, 'Possível vulnerabilidade: Acesso a IP local permitido!');
                    } else {
                        displayResult('local-ip-result', false, 'Sandbox segura: Não foi possível acessar IPs locais.');
                    }
                }
            }
        }

        function testWebSocket() {
            try {
                const resultElement = document.getElementById('websocket-result');
                resultElement.innerHTML = 'Testando...';
                
                // Tenta estabelecer uma conexão WebSocket com uma origem diferente
                const ws = new WebSocket('ws://example.com:8080');
                
                ws.onopen = function() {
                    displayResult('websocket-result', true, 'Possível vulnerabilidade: Conexão WebSocket estabelecida com origem diferente!');
                    ws.close();
                };
                
                ws.onerror = function(error) {
                    displayResult('websocket-result', false, 'Sandbox segura: Não foi possível estabelecer conexão WebSocket com origem diferente.');
                };
            } catch (e) {
                displayResult('websocket-result', false, 'Sandbox segura: ' + e.message);
            }
        }

        function testRestrictedPorts() {
            const resultElement = document.getElementById('restricted-ports-result');
            resultElement.innerHTML = 'Testando...';
            
            // Portas comumente restritas
            const ports = [1, 7, 9, 11, 13, 15, 17, 19, 20, 21, 22, 23, 25, 37, 42, 43, 53, 77, 79, 87, 95, 101, 102, 103, 104, 109, 110, 111, 113, 115, 117, 119, 123, 135, 139, 143, 179, 389, 465, 512, 513, 514, 515, 526, 530, 531, 532, 540, 556, 563, 587, 601, 636, 993, 995, 2049, 3659, 4045, 6000];
            let completedTests = 0;
            let anySuccess = false;
            
            ports.slice(0, 5).forEach(port => { // Testando apenas 5 portas para não sobrecarregar
                fetch(`http://example.com:${port}`)
                    .then(response => {
                        anySuccess = true;
                        completedTests++;
                        checkCompletion();
                    })
                    .catch(error => {
                        completedTests++;
                        checkCompletion();
                    });
            });
            
            function checkCompletion() {
                if (completedTests === 5) {
                    if (anySuccess) {
                        displayResult('restricted-ports-result', true, 'Possível vulnerabilidade: Acesso a portas restritas permitido!');
                    } else {
                        displayResult('restricted-ports-result', false, 'Sandbox segura: Não foi possível acessar portas restritas.');
                    }
                }
            }
        }

        // Testes de Armazenamento
        function testFileSystemAccess() {
            try {
                // Tenta acessar a API de sistema de arquivos
                if (window.requestFileSystem || window.webkitRequestFileSystem) {
                    const requestFS = window.requestFileSystem || window.webkitRequestFileSystem;
                    
                    requestFS(window.TEMPORARY, 5*1024*1024, function(fs) {
                        // Tenta criar um arquivo
                        fs.root.getFile('test.txt', {create: true}, function(fileEntry) {
                            fileEntry.createWriter(function(fileWriter) {
                                fileWriter.onwriteend = function(e) {
                                    displayResult('filesystem-result', false, 'Acesso ao sistema de arquivos temporário permitido, mas isso é esperado e limitado à sandbox.');
                                };
                                
                                fileWriter.onerror = function(e) {
                                    displayResult('filesystem-result', false, 'Sandbox segura: Não foi possível escrever no sistema de arquivos temporário.');
                                };
                                
                                const blob = new Blob(['Teste de escrita no sistema de arquivos'], {type: 'text/plain'});
                                fileWriter.write(blob);
                            }, function(error) {
                                displayResult('filesystem-result', false, 'Sandbox segura: Não foi possível criar um escritor de arquivo.');
                            });
                        }, function(error) {
                            displayResult('filesystem-result', false, 'Sandbox segura: Não foi possível criar um arquivo.');
                        });
                    }, function(error) {
                        displayResult('filesystem-result', false, 'Sandbox segura: Não foi possível acessar o sistema de arquivos.');
                    });
                } else {
                    displayResult('filesystem-result', false, 'Sandbox segura: API de sistema de arquivos não disponível.');
                }
            } catch (e) {
                displayResult('filesystem-result', false, 'Sandbox segura: ' + e.message);
            }
        }

        function testIndexedDB() {
            try {
                // Tenta acessar o IndexedDB
                if (!window.indexedDB) {
                    displayResult('indexeddb-result', false, 'Sandbox segura: IndexedDB não disponível.');
                    return;
                }
                
                const request = indexedDB.open('testDatabase', 1);
                
                request.onerror = function(event) {
                    displayResult('indexeddb-result', false, 'Sandbox segura: Não foi possível abrir o IndexedDB.');
                };
                
                request.onsuccess = function(event) {
                    displayResult('indexeddb-result', false, 'Acesso ao IndexedDB permitido, mas isso é esperado e limitado à sandbox.');
                    const db = event.target.result;
                    db.close();
                    // Tenta excluir o banco de dados de teste
                    indexedDB.deleteDatabase('testDatabase');
                };
                
                request.onupgradeneeded = function(event) {
                    const db = event.target.result;
                    const objectStore = db.createObjectStore('testStore', { keyPath: 'id' });
                };
            } catch (e) {
                displayResult('indexeddb-result', false, 'Sandbox segura: ' + e.message);
            }
        }

        function testLocalStorage() {
            try {
                // Tenta acessar o localStorage
                if (typeof localStorage === 'undefined') {
                    displayResult('localstorage-result', false, 'Sandbox segura: localStorage não disponível.');
                    return;
                }
                
                // Tenta escrever no localStorage
                localStorage.setItem('testKey', 'testValue');
                
                // Verifica se o valor foi escrito corretamente
                const value = localStorage.getItem('testKey');
                
                if (value === 'testValue') {
                    displayResult('localstorage-result', false, 'Acesso ao localStorage permitido, mas isso é esperado e limitado à sandbox.');
                } else {
                    displayResult('localstorage-result', false, 'Sandbox segura: Não foi possível escrever no localStorage.');
                }
                
                // Limpa o valor de teste
                localStorage.removeItem('testKey');
            } catch (e) {
                displayResult('localstorage-result', false, 'Sandbox segura: ' + e.message);
            }
        }

        function testCookieAccess() {
            try {
                // Tenta acessar cookies
                document.cookie = 'testCookie=testValue; path=/';
                
                // Verifica se o cookie foi definido
                if (document.cookie.indexOf('testCookie=testValue') !== -1) {
                    displayResult('cookie-result', false, 'Acesso a cookies permitido, mas isso é esperado e limitado à sandbox.');
                } else {
                    displayResult('cookie-result', false, 'Sandbox segura: Não foi possível definir cookies.');
                }
                
                // Tenta definir um cookie para outro domínio (deve falhar)
                try {
                    document.cookie = 'maliciousCookie=hack; domain=example.com; path=/';
                    
                    // Verifica se o cookie malicioso foi definido
                    if (document.cookie.indexOf('maliciousCookie=hack') !== -1) {
                        displayResult('cookie-result', true, 'Possível vulnerabilidade: Conseguiu definir cookie para outro domínio!');
                    }
                } catch (e) {
                    // Isso é esperado
                }
            } catch (e) {
                displayResult('cookie-result', false, 'Sandbox segura: ' + e.message);
            }
        }

        // Testes de API
        function testGeolocation() {
            try {
                // Verifica se a API de geolocalização está disponível
                if (!navigator.geolocation) {
                    displayResult('geolocation-result', false, 'Sandbox segura: API de geolocalização não disponível.');
                    return;
                }
                
                // Tenta obter a localização atual
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        displayWarning('geolocation-result', 'API de geolocalização disponível e funcionando. Isso pode ser normal dependendo das permissões concedidas.');
                    },
                    function(error) {
                        displayResult('geolocation-result', false, 'Sandbox segura: Não foi possível obter a geolocalização. ' + error.message);
                    }
                );
            } catch (e) {
                displayResult('geolocation-result', false, 'Sandbox segura: ' + e.message);
            }
        }

        function testMediaDevices() {
            try {
                // Verifica se a API de dispositivos de mídia está disponível
                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    displayResult('media-devices-result', false, 'Sandbox segura: API de dispositivos de mídia não disponível.');
                    return;
                }
                
                // Tenta acessar a câmera e o microfone
                navigator.mediaDevices.getUserMedia({ audio: true, video: true })
                    .then(function(stream) {
                        displayWarning('media-devices-result', 'Acesso à câmera e ao microfone permitido. Isso pode ser normal dependendo das permissões concedidas.');
                        // Interrompe todos os tracks para liberar os dispositivos
                        stream.getTracks().forEach(track => track.stop());
                    })
                    .catch(function(error) {
                        displayResult('media-devices-result', false, 'Sandbox segura: Não foi possível acessar a câmera e o microfone. ' + error.message);
                    });
            } catch (e) {
                displayResult('media-devices-result', false, 'Sandbox segura: ' + e.message);
            }
        }

        function testNotifications() {
            try {
                // Verifica se a API de notificações está disponível
                if (!window.Notification) {
                    displayResult('notifications-result', false, 'Sandbox segura: API de notificações não disponível.');
                    return;
                }
                
                // Verifica a permissão atual
                if (Notification.permission === 'granted') {
                    displayWarning('notifications-result', 'Permissão para notificações já concedida. Isso pode ser normal dependendo das permissões concedidas.');
                } else if (Notification.permission === 'denied') {
                    displayResult('notifications-result', false, 'Sandbox segura: Permissão para notificações negada.');
                } else {
                    // Solicita permissão
                    Notification.requestPermission()
                        .then(function(permission) {
                            if (permission === 'granted') {
                                displayWarning('notifications-result', 'Permissão para notificações concedida. Isso pode ser normal dependendo das permissões concedidas.');
                            } else {
                                displayResult('notifications-result', false, 'Sandbox segura: Permissão para notificações negada.');
                            }
                        });
                }
            } catch (e) {
                displayResult('notifications-result', false, 'Sandbox segura: ' + e.message);
            }
        }

        function testBluetooth() {
            try {
                // Verifica se a API de Bluetooth está disponível
                if (!navigator.bluetooth) {
                    displayResult('bluetooth-result', false, 'Sandbox segura: API de Bluetooth não disponível.');
                    return;
                }
                
                // Tenta solicitar um dispositivo Bluetooth
                navigator.bluetooth.requestDevice({ acceptAllDevices: true })
                    .then(function(device) {
                        displayWarning('bluetooth-result', 'Acesso ao Bluetooth permitido. Isso pode ser normal dependendo das permissões concedidas.');
                    })
                    .catch(function(error) {
                        displayResult('bluetooth-result', false, 'Sandbox segura: Não foi possível acessar o Bluetooth. ' + error.message);
                    });
            } catch (e) {
                displayResult('bluetooth-result', false, 'Sandbox segura: ' + e.message);
            }
        }

        // Testes de Execução de Código
        function testArbitraryExecution() {
            try {
                // Tenta executar código arbitrário
                const originalAlert = window.alert;
                let alertCalled = false;
                
                // Tenta substituir a função alert
                window.alert = function() {
                    alertCalled = true;
                    return originalAlert.apply(this, arguments);
                };
                
                // Verifica se a substituição funcionou
                if (window.alert !== originalAlert) {
                    // Restaura a função original
                    window.alert = originalAlert;
                    displayResult('arbitrary-execution-result', false, 'Modificação de funções globais permitida, mas isso é esperado e limitado à sandbox.');
                } else {
                    displayResult('arbitrary-execution-result', false, 'Sandbox segura: Não foi possível modificar funções globais.');
                }
                
                // Tenta usar eval para executar código
                try {
                    const result = eval('2 + 2');
                    if (result === 4) {
                        displayResult('arbitrary-execution-result', false, 'Função eval disponível, mas isso é esperado e limitado à sandbox.');
                    }
                } catch (e) {
                    displayResult('arbitrary-execution-result', false, 'Sandbox segura: Função eval bloqueada.');
                }
            } catch (e) {
                displayResult('arbitrary-execution-result', false, 'Sandbox segura: ' + e.message);
            }
        }

        function testNativeAPIs() {
            try {
                // Lista de possíveis APIs nativas para testar
                const nativeAPIs = [
                    { name: 'Node.js process', obj: window.process },
                    { name: 'Electron', obj: window.electron },
                    { name: 'require', obj: window.require },
                    { name: 'Chrome Extensions', obj: window.chrome && window.chrome.extension },
                    { name: 'Firefox Extensions', obj: window.browser && window.browser.extension }
                ];
                
                let accessibleAPIs = [];
                
                nativeAPIs.forEach(api => {
                    if (api.obj) {
                        accessibleAPIs.push(api.name);
                    }
                });
                
                if (accessibleAPIs.length > 0) {
                    displayResult('native-apis-result', true, 'Possível vulnerabilidade: Acesso a APIs nativas detectado! ' + accessibleAPIs.join(', '));
                } else {
                    displayResult('native-apis-result', false, 'Sandbox segura: Não foi possível acessar APIs nativas.');
                }
            } catch (e) {
                displayResult('native-apis-result', false, 'Sandbox segura: ' + e.message);
            }
        }

        function testWebAssembly() {
            try {
                // Verifica se o WebAssembly está disponível
                if (typeof WebAssembly === 'undefined') {
                    displayResult('webassembly-result', false, 'Sandbox segura: WebAssembly não disponível.');
                    return;
                }
                
                // Código WebAssembly simples (função que retorna 42)
                const wasmCode = new Uint8Array([
                    0x00, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00, 0x00,
                    0x01, 0x06, 0x01, 0x60, 0x00, 0x01, 0x7f, 0x03,
                    0x02, 0x01, 0x00, 0x07, 0x0a, 0x01, 0x06, 0x67,
                    0x65, 0x74, 0x5f, 0x34, 0x32, 0x00, 0x00, 0x0a,
                    0x06, 0x01, 0x04, 0x00, 0x41, 0x2a, 0x0b
                ]);
                
                // Compila e instancia o módulo WebAssembly
                WebAssembly.instantiate(wasmCode)
                    .then(result => {
                        const instance = result.instance;
                        const get42 = instance.exports.get_42;
                        
                        if (get42() === 42) {
                            displayResult('webassembly-result', false, 'WebAssembly disponível e funcionando, mas isso é esperado e limitado à sandbox.');
                        } else {
                            displayResult('webassembly-result', false, 'Sandbox segura: WebAssembly disponível, mas não está funcionando corretamente.');
                        }
                    })
                    .catch(error => {
                        displayResult('webassembly-result', false, 'Sandbox segura: Não foi possível executar WebAssembly. ' + error.message);
                    });
            } catch (e) {
                displayResult('webassembly-result', false, 'Sandbox segura: ' + e.message);
            }
        }

        function testServiceWorkers() {
            try {
                // Verifica se os Service Workers estão disponíveis
                if (!navigator.serviceWorker) {
                    displayResult('service-workers-result', false, 'Sandbox segura: Service Workers não disponíveis.');
                    return;
                }
                
                // Tenta registrar um Service Worker
                navigator.serviceWorker.register('/sw-test.js')
                    .then(function(registration) {
                        displayResult('service-workers-result', true, 'Possível vulnerabilidade: Service Worker registrado com sucesso!');
                    })
                    .catch(function(error) {
                        displayResult('service-workers-result', false, 'Sandbox segura: Não foi possível registrar Service Worker. ' + error.message);
                    });
            } catch (e) {
                displayResult('service-workers-result', false, 'Sandbox segura: ' + e.message);
            }
        }

        function testSharedWorkers() {
            try {
                // Verifica se os Shared Workers estão disponíveis
                if (typeof SharedWorker === 'undefined') {
                    displayResult('shared-workers-result', false, 'Sandbox segura: Shared Workers não disponíveis.');
                    return;
                }
                
                // Tenta criar um Shared Worker
                const worker = new SharedWorker('data:application/javascript,self.onconnect=function(e){var port=e.ports[0];port.postMessage("hello");};');
                
                worker.port.onmessage = function(e) {
                    if (e.data === 'hello') {
                        displayResult('shared-workers-result', true, 'Possível vulnerabilidade: Shared Worker criado com sucesso usando data URL!');
                    } else {
                        displayResult('shared-workers-result', false, 'Sandbox segura: Shared Worker criado, mas com comportamento inesperado.');
                    }
                };
                
                worker.port.start();
                
                // Timeout para caso o worker não responda
                setTimeout(function() {
                    if (document.getElementById('shared-workers-result').textContent === 'Testando...') {
                        displayResult('shared-workers-result', false, 'Sandbox segura: Shared Worker não respondeu.');
                    }
                }, 1000);
            } catch (e) {
                displayResult('shared-workers-result', false, 'Sandbox segura: ' + e.message);
            }
        }

        function testWebWorkers() {
            try {
                // Verifica se os Web Workers estão disponíveis
                if (typeof Worker === 'undefined') {
                    displayResult('web-workers-result', false, 'Sandbox segura: Web Workers não disponíveis.');
                    return;
                }
                
                // Tenta criar um Web Worker usando data URL
                const workerCode = `
                    self.onmessage = function(e) {
                        // Tenta acessar APIs restritas
                        let results = {
                            hasWindow: typeof window !== 'undefined',
                            hasDocument: typeof document !== 'undefined',
                            hasNavigator: typeof navigator !== 'undefined',
                            hasLocation: typeof location !== 'undefined',
                            hasXMLHttpRequest: typeof XMLHttpRequest !== 'undefined'
                        };
                        
                        self.postMessage(results);
                    };
                `;
                
                const blob = new Blob([workerCode], { type: 'application/javascript' });
                const worker = new Worker(URL.createObjectURL(blob));
                
                worker.onmessage = function(e) {
                    const results = e.data;
                    let message = 'Web Worker criado com sucesso. APIs disponíveis: ';
                    let apis = [];
                    
                    for (let api in results) {
                        if (results[api]) {
                            apis.push(api.replace('has', ''));
                        }
                    }
                    
                    if (apis.length > 0) {
                        message += apis.join(', ');
                        displayResult('web-workers-result', false, message);
                    } else {
                        displayResult('web-workers-result', false, 'Web Worker criado, mas com acesso limitado a APIs (comportamento esperado).');
                    }
                    
                    worker.terminate();
                };
                
                worker.onerror = function(error) {
                    displayResult('web-workers-result', false, 'Sandbox segura: Erro ao executar Web Worker. ' + error.message);
                    worker.terminate();
                };
                
                worker.postMessage('start');
            } catch (e) {
                displayResult('web-workers-result', false, 'Sandbox segura: ' + e.message);
            }
        }
    </script>
</body>
</html>
