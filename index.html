<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exploração de Vulnerabilidades</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f0f0;
        }
        h1, h2, h3 {
            color: #333;
        }
        .exploit-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .exploit-card {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .exploit-card h3 {
            margin-top: 0;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            color: #d32f2f;
        }
        button {
            background-color: #d32f2f;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
        }
        button:hover {
            background-color: #b71c1c;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            min-height: 50px;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            white-space: pre-wrap;
            word-break: break-all;
        }
        .success {
            color: #d32f2f;
            font-weight: bold;
        }
        .failure {
            color: #333;
        }
        .nav-buttons {
            position: sticky;
            top: 0;
            background-color: #fff;
            padding: 10px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            z-index: 100;
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .refresh-button {
            background-color: #333;
        }
        #data-display {
            background-color: #fff;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            white-space: pre-wrap;
            word-break: break-all;
        }
        textarea {
            width: 100%;
            height: 100px;
            margin-top: 10px;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        iframe {
            width: 100%;
            height: 200px;
            border: 1px solid #ddd;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="nav-buttons">
        <h1>Exploração de Vulnerabilidades</h1>
        <button class="refresh-button" onclick="location.reload()">Atualizar Página</button>
    </div>

    <p>Esta página explora mais profundamente as vulnerabilidades encontradas no teste anterior.</p>
    
    <div id="data-display">
        <h2>Dados Coletados</h2>
        <div id="collected-data">Nenhum dado coletado ainda.</div>
    </div>

    <h2>Exploração do DOM</h2>
    <div class="exploit-container">
        <div class="exploit-card">
            <h3>Exploração do Acesso ao DOM</h3>
            <p>Tenta extrair informações do documento principal e manipular o DOM.</p>
            <button onclick="exploitDOMAccess()">Executar Exploração</button>
            <div id="dom-exploit-result" class="result"></div>
        </div>

        <div class="exploit-card">
            <h3>Injeção de Script Avançada</h3>
            <p>Tenta injetar scripts mais complexos para obter acesso privilegiado.</p>
            <button onclick="exploitScriptInjection()">Executar Exploração</button>
            <div id="script-exploit-result" class="result"></div>
        </div>

        <div class="exploit-card">
            <h3>Manipulação de Cookies</h3>
            <p>Tenta acessar e manipular cookies de outros domínios.</p>
            <button onclick="exploitCookies()">Executar Exploração</button>
            <div id="cookie-exploit-result" class="result"></div>
        </div>
    </div>

    <h2>Exploração de Workers</h2>
    <div class="exploit-container">
        <div class="exploit-card">
            <h3>Shared Worker Avançado</h3>
            <p>Explora a vulnerabilidade do Shared Worker com data URL para tentar executar código privilegiado.</p>
            <button onclick="exploitSharedWorker()">Executar Exploração</button>
            <div id="shared-worker-exploit-result" class="result"></div>
        </div>

        <div class="exploit-card">
            <h3>Comunicação Entre Workers</h3>
            <p>Tenta estabelecer comunicação entre diferentes tipos de workers para escapar da sandbox.</p>
            <button onclick="exploitWorkerCommunication()">Executar Exploração</button>
            <div id="worker-communication-result" class="result"></div>
        </div>

        <div class="exploit-card">
            <h3>Exploração de Service Worker</h3>
            <p>Tenta registrar um Service Worker para interceptar requisições de rede.</p>
            <button onclick="exploitServiceWorker()">Executar Exploração</button>
            <div id="service-worker-exploit-result" class="result"></div>
        </div>
    </div>

    <h2>Exploração de Rede e Sistema</h2>
    <div class="exploit-container">
        <div class="exploit-card">
            <h3>Exploração de Iframe</h3>
            <p>Tenta criar um iframe para acessar conteúdo de outros domínios.</p>
            <button onclick="exploitIframe()">Executar Exploração</button>
            <div id="iframe-container"></div>
            <div id="iframe-exploit-result" class="result"></div>
        </div>

        <div class="exploit-card">
            <h3>Exploração de WebSocket</h3>
            <p>Tenta estabelecer conexões WebSocket com servidores externos.</p>
            <button onclick="exploitWebSocket()">Executar Exploração</button>
            <div id="websocket-exploit-result" class="result"></div>
        </div>

        <div class="exploit-card">
            <h3>Exploração de Armazenamento</h3>
            <p>Tenta acessar e manipular diferentes tipos de armazenamento.</p>
            <button onclick="exploitStorage()">Executar Exploração</button>
            <div id="storage-exploit-result" class="result"></div>
        </div>
    </div>

    <h2>Exploração de Código</h2>
    <div class="exploit-container">
        <div class="exploit-card">
            <h3>Execução de Código Personalizado</h3>
            <p>Digite o código JavaScript que deseja executar:</p>
            <textarea id="custom-code">// Seu código aqui
console.log(window.location);
try {
  console.log(window.top.document.domain);
} catch(e) {
  console.log('Erro: ' + e.message);
}</textarea>
            <button onclick="executeCustomCode()">Executar Código</button>
            <div id="custom-code-result" class="result"></div>
        </div>

        <div class="exploit-card">
            <h3>Exploração de Prototype</h3>
            <p>Tenta modificar prototypes de objetos nativos para escapar da sandbox.</p>
            <button onclick="exploitPrototype()">Executar Exploração</button>
            <div id="prototype-exploit-result" class="result"></div>
        </div>

        <div class="exploit-card">
            <h3>Exploração de Eval</h3>
            <p>Tenta usar eval() de maneiras diferentes para executar código privilegiado.</p>
            <button onclick="exploitEval()">Executar Exploração</button>
            <div id="eval-exploit-result" class="result"></div>
        </div>
    </div>

    <script>
        // Função para exibir resultados
        function displayResult(elementId, success, message) {
            const resultElement = document.getElementById(elementId);
            resultElement.innerHTML = message;
            resultElement.className = success ? 'result success' : 'result failure';
            
            if (success) {
                updateCollectedData(elementId, message);
            }
        }

        // Função para atualizar os dados coletados
        function updateCollectedData(source, data) {
            const dataDisplay = document.getElementById('collected-data');
            if (dataDisplay.textContent === 'Nenhum dado coletado ainda.') {
                dataDisplay.textContent = '';
            }
            
            const timestamp = new Date().toLocaleTimeString();
            dataDisplay.innerHTML += `<strong>[${timestamp} - ${source}]</strong>\n${data}\n\n`;
        }

        // Exploração do DOM
        function exploitDOMAccess() {
            try {
                let results = [];
                
                // Tenta acessar o DOM principal
                try {
                    const domain = document.domain;
                    results.push(`Domínio atual: ${domain}`);
                } catch (e) {
                    results.push(`Erro ao acessar domínio: ${e.message}`);
                }
                
                // Tenta acessar o documento pai
                try {
                    const parentDomain = window.parent.document.domain;
                    results.push(`Domínio pai: ${parentDomain}`);
                    displayResult('dom-exploit-result', true, results.join('\n'));
                    return;
                } catch (e) {
                    results.push(`Erro ao acessar domínio pai: ${e.message}`);
                }
                
                // Tenta acessar o documento principal
                try {
                    const topDomain = window.top.document.domain;
                    results.push(`Domínio principal: ${topDomain}`);
                    displayResult('dom-exploit-result', true, results.join('\n'));
                    return;
                } catch (e) {
                    results.push(`Erro ao acessar domínio principal: ${e.message}`);
                }
                
                // Tenta acessar propriedades do navegador
                try {
                    results.push(`User Agent: ${navigator.userAgent}`);
                    results.push(`Plataforma: ${navigator.platform}`);
                    results.push(`Linguagem: ${navigator.language}`);
                    results.push(`Cookies habilitados: ${navigator.cookieEnabled}`);
                } catch (e) {
                    results.push(`Erro ao acessar propriedades do navegador: ${e.message}`);
                }
                
                // Verifica se conseguiu acessar alguma informação privilegiada
                if (results.some(r => r.includes('Domínio pai:') || r.includes('Domínio principal:'))) {
                    displayResult('dom-exploit-result', true, results.join('\n'));
                } else {
                    displayResult('dom-exploit-result', false, results.join('\n'));
                }
            } catch (e) {
                displayResult('dom-exploit-result', false, `Erro geral: ${e.message}`);
            }
        }

        // Exploração de injeção de script
        function exploitScriptInjection() {
            try {
                let results = [];
                
                // Tenta injetar um script no DOM
                const script = document.createElement('script');
                const uniqueVarName = 'scriptInjectionTest_' + Math.random().toString(36).substring(2);
                script.textContent = `window.${uniqueVarName} = { 
                    success: true, 
                    timestamp: '${new Date().toISOString()}',
                    location: window.location.href,
                    referrer: document.referrer
                };`;
                document.head.appendChild(script);
                
                // Verifica se o script foi executado
                setTimeout(() => {
                    if (window[uniqueVarName]) {
                        results.push(`Script injetado com sucesso!`);
                        results.push(`Timestamp: ${window[uniqueVarName].timestamp}`);
                        results.push(`Location: ${window[uniqueVarName].location}`);
                        results.push(`Referrer: ${window[uniqueVarName].referrer}`);
                        
                        // Tenta acessar mais informações
                        try {
                            // Tenta modificar o comportamento de funções nativas
                            const originalFetch = window.fetch;
                            window.fetch = function(url, options) {
                                results.push(`Interceptação de fetch: ${url}`);
                                return originalFetch.apply(this, arguments);
                            };
                            results.push('Função fetch modificada com sucesso!');
                            
                            // Restaura a função original
                            window.fetch = originalFetch;
                        } catch (e) {
                            results.push(`Erro ao modificar funções: ${e.message}`);
                        }
                        
                        displayResult('script-exploit-result', true, results.join('\n'));
                    } else {
                        results.push('Falha na injeção de script.');
                        displayResult('script-exploit-result', false, results.join('\n'));
                    }
                }, 500);
            } catch (e) {
                displayResult('script-exploit-result', false, `Erro geral: ${e.message}`);
            }
        }

        // Exploração de cookies
        function exploitCookies() {
            try {
                let results = [];
                
                // Lista os cookies atuais
                results.push(`Cookies atuais: ${document.cookie || 'Nenhum'}`);
                
                // Tenta definir um cookie normal
                const cookieName = 'testCookie_' + Math.random().toString(36).substring(2);
                document.cookie = `${cookieName}=valor_teste; path=/`;
                
                // Verifica se o cookie foi definido
                if (document.cookie.includes(cookieName)) {
                    results.push(`Cookie normal definido com sucesso: ${cookieName}`);
                } else {
                    results.push('Falha ao definir cookie normal.');
                }
                
                // Tenta definir um cookie para outro domínio (deve falhar)
                try {
                    const maliciousCookieName = 'maliciousCookie_' + Math.random().toString(36).substring(2);
                    document.cookie = `${maliciousCookieName}=valor_malicioso; domain=example.com; path=/`;
                    
                    // Verifica se o cookie malicioso foi definido
                    if (document.cookie.includes(maliciousCookieName)) {
                        results.push(`VULNERABILIDADE: Cookie definido para outro domínio: ${maliciousCookieName}`);
                        displayResult('cookie-exploit-result', true, results.join('\n'));
                        return;
                    } else {
                        results.push('Cookie para outro domínio não foi definido (comportamento esperado).');
                    }
                } catch (e) {
                    results.push(`Erro ao tentar definir cookie para outro domínio: ${e.message}`);
                }
                
                // Tenta acessar cookies HttpOnly via JavaScript (deve falhar)
                try {
                    // Não há como acessar diretamente, mas podemos verificar se existem cookies que não aparecem em document.cookie
                    results.push('Não é possível acessar cookies HttpOnly via JavaScript.');
                } catch (e) {
                    results.push(`Erro ao tentar acessar cookies HttpOnly: ${e.message}`);
                }
                
                displayResult('cookie-exploit-result', false, results.join('\n'));
            } catch (e) {
                displayResult('cookie-exploit-result', false, `Erro geral: ${e.message}`);
            }
        }

        // Exploração de Shared Worker
        function exploitSharedWorker() {
            try {
                let results = [];
                
                // Verifica se os Shared Workers estão disponíveis
                if (typeof SharedWorker === 'undefined') {
                    results.push('Shared Workers não estão disponíveis neste navegador.');
                    displayResult('shared-worker-exploit-result', false, results.join('\n'));
                    return;
                }
                
                results.push('Shared Workers estão disponíveis!');
                
                // Cria um Shared Worker usando data URL com código mais complexo
                const workerCode = `
                    // Código do Shared Worker
                    let systemInfo = {};
                    
                    // Tenta coletar informações do sistema
                    try {
                        systemInfo.userAgent = self.navigator ? self.navigator.userAgent : 'N/A';
                        systemInfo.platform = self.navigator ? self.navigator.platform : 'N/A';
                        systemInfo.language = self.navigator ? self.navigator.language : 'N/A';
                        systemInfo.hardwareConcurrency = self.navigator ? self.navigator.hardwareConcurrency : 'N/A';
                        systemInfo.memory = self.performance ? self.performance.memory : 'N/A';
                    } catch(e) {
                        systemInfo.error = e.message;
                    }
                    
                    // Tenta acessar APIs restritas
                    try {
                        systemInfo.hasProcess = typeof self.process !== 'undefined';
                        systemInfo.hasRequire = typeof self.require !== 'undefined';
                        systemInfo.hasChrome = typeof self.chrome !== 'undefined';
                    } catch(e) {
                        systemInfo.restrictedError = e.message;
                    }
                    
                    // Manipulador de conexão
                    self.onconnect = function(e) {
                        const port = e.ports[0];
                        
                        port.onmessage = function(event) {
                            if (event.data === 'getInfo') {
                                port.postMessage({
                                    type: 'systemInfo',
                                    data: systemInfo
                                });
                            }
                            
                            // Tenta executar código enviado pelo cliente
                            if (event.data.type === 'eval') {
                                try {
                                    const result = eval(event.data.code);
                                    port.postMessage({
                                        type: 'evalResult',
                                        success: true,
                                        result: result
                                    });
                                } catch(e) {
                                    port.postMessage({
                                        type: 'evalResult',
                                        success: false,
                                        error: e.message
                                    });
                                }
                            }
                        };
                        
                        // Envia mensagem inicial
                        port.postMessage({
                            type: 'connected',
                            timestamp: new Date().toString()
                        });
                        
                        port.start();
                    };
                `;
                
                // Cria um Blob com o código do worker
                const blob = new Blob([workerCode], { type: 'application/javascript' });
                const workerUrl = URL.createObjectURL(blob);
                
                // Alternativa usando data URL diretamente
                const dataUrl = 'data:application/javascript,' + encodeURIComponent(workerCode);
                
                // Tenta criar o worker usando o Blob URL
                try {
                    results.push('Tentando criar Shared Worker usando Blob URL...');
                    const worker = new SharedWorker(workerUrl);
                    setupWorkerCommunication(worker, results, 'shared-worker-exploit-result', true);
                } catch (e) {
                    results.push(`Erro ao criar Shared Worker com Blob URL: ${e.message}`);
                    
                    // Tenta criar o worker usando data URL
                    try {
                        results.push('Tentando criar Shared Worker usando data URL...');
                        const worker = new SharedWorker(dataUrl);
                        setupWorkerCommunication(worker, results, 'shared-worker-exploit-result', true);
                    } catch (e) {
                        results.push(`Erro ao criar Shared Worker com data URL: ${e.message}`);
                        displayResult('shared-worker-exploit-result', false, results.join('\n'));
                    }
                }
            } catch (e) {
                displayResult('shared-worker-exploit-result', false, `Erro geral: ${e.message}`);
            }
        }

        // Configuração da comunicação com o worker
        function setupWorkerCommunication(worker, results, resultElementId, isVulnerability) {
            worker.port.onmessage = function(e) {
                if (e.data.type === 'connected') {
                    results.push(`Worker conectado em: ${e.data.timestamp}`);
                    worker.port.postMessage('getInfo');
                }
                
                if (e.data.type === 'systemInfo') {
                    results.push('Informações do sistema obtidas do worker:');
                    for (const [key, value] of Object.entries(e.data.data)) {
                        results.push(`- ${key}: ${JSON.stringify(value)}`);
                    }
                    
                    // Tenta executar código no worker
                    worker.port.postMessage({
                        type: 'eval',
                        code: 'self.location ? self.location.toString() : "Localização não disponível"'
                    });
                }
                
                if (e.data.type === 'evalResult') {
                    if (e.data.success) {
                        results.push(`Execução de código no worker bem-sucedida: ${e.data.result}`);
                    } else {
                        results.push(`Erro na execução de código no worker: ${e.data.error}`);
                    }
                    
                    displayResult(resultElementId, isVulnerability, results.join('\n'));
                }
            };
            
            worker.port.onerror = function(error) {
                results.push(`Erro no worker: ${error.message}`);
                displayResult(resultElementId, false, results.join('\n'));
            };
            
            worker.port.start();
            
            // Timeout para caso o worker não responda
            setTimeout(function() {
                if (!results.some(r => r.includes('Execução de código'))) {
                    results.push('Timeout: O worker não respondeu completamente.');
                    displayResult(resultElementId, false, results.join('\n'));
                }
            }, 3000);
        }

        // Exploração de comunicação entre workers
        function exploitWorkerCommunication() {
            try {
                let results = [];
                
                // Verifica se os Web Workers estão disponíveis
                if (typeof Worker === 'undefined') {
                    results.push('Web Workers não estão disponíveis neste navegador.');
                    displayResult('worker-communication-result', false, results.join('\n'));
                    return;
                }
                
                results.push('Web Workers estão disponíveis!');
                
                // Código para o Web Worker
                const webWorkerCode = `
                    // Tenta acessar APIs restritas
                    const accessResults = {
                        hasWindow: typeof window !== 'undefined',
                        hasDocument: typeof document !== 'undefined',
                        hasNavigator: typeof navigator !== 'undefined',
                        hasLocation: typeof location !== 'undefined',
                        hasXMLHttpRequest: typeof XMLHttpRequest !== 'undefined',
                        hasIndexedDB: typeof indexedDB !== 'undefined',
                        hasWebSocket: typeof WebSocket !== 'undefined',
                        hasSharedWorker: typeof SharedWorker !== 'undefined',
                        hasServiceWorker: typeof ServiceWorker !== 'undefined'
                    };
                    
                    // Tenta fazer uma requisição de rede
                    let networkResult = 'Não testado';
                    if (typeof fetch !== 'undefined') {
                        fetch('https://example.com')
                            .then(response => response.text())
                            .then(text => {
                                networkResult = 'Sucesso: ' + text.substring(0, 50) + '...';
                                self.postMessage({ type: 'networkResult', data: networkResult });
                            })
                            .catch(error => {
                                networkResult = 'Erro: ' + error.message;
                                self.postMessage({ type: 'networkResult', data: networkResult });
                            });
                    }
                    
                    // Responde à mensagem inicial
                    self.onmessage = function(e) {
                        if (e.data === 'getInfo') {
                            self.postMessage({
                                type: 'accessResults',
                                data: accessResults
                            });
                        }
                    };
                    
                    // Envia mensagem inicial
                    self.postMessage({
                        type: 'connected',
                        timestamp: new Date().toString()
                    });
                `;
                
                // Cria um Blob com o código do worker
                const blob = new Blob([webWorkerCode], { type: 'application/javascript' });
                const workerUrl = URL.createObjectURL(blob);
                
                // Cria o Web Worker
                const worker = new Worker(workerUrl);
                
                worker.onmessage = function(e) {
                    if (e.data.type === 'connected') {
                        results.push(`Web Worker conectado em: ${e.data.timestamp}`);
                        worker.postMessage('getInfo');
                    }
                    
                    if (e.data.type === 'accessResults') {
                        results.push('Resultados de acesso do Web Worker:');
                        for (const [key, value] of Object.entries(e.data.data)) {
                            results.push(`- ${key}: ${value}`);
                        }
                        
                        // Verifica se há alguma API disponível que não deveria estar
                        const unexpectedAccess = Object.entries(e.data.data)
                            .filter(([key, value]) => value && (key === 'hasWindow' || key === 'hasDocument'))
                            .map(([key]) => key);
                        
                        if (unexpectedAccess.length > 0) {
                            results.push(`VULNERABILIDADE: Acesso inesperado a: ${unexpectedAccess.join(', ')}`);
                            displayResult('worker-communication-result', true, results.join('\n'));
                        }
                    }
                    
                    if (e.data.type === 'networkResult') {
                        results.push(`Resultado da requisição de rede: ${e.data.data}`);
                        displayResult('worker-communication-result', false, results.join('\n'));
                    }
                };
                
                worker.onerror = function(error) {
                    results.push(`Erro no Web Worker: ${error.message}`);
                    displayResult('worker-communication-result', false, results.join('\n'));
                };
                
                // Timeout para caso o worker não responda
                setTimeout(function() {
                    if (!results.some(r => r.includes('Resultados de acesso'))) {
                        results.push('Timeout: O Web Worker não respondeu completamente.');
                        displayResult('worker-communication-result', false, results.join('\n'));
                    }
                }, 3000);
            } catch (e) {
                displayResult('worker-communication-result', false, `Erro geral: ${e.message}`);
            }
        }

        // Exploração de Service Worker
        function exploitServiceWorker() {
            try {
                let results = [];
                
                // Verifica se os Service Workers estão disponíveis
                if (!navigator.serviceWorker) {
                    results.push('Service Workers não estão disponíveis neste navegador.');
                    displayResult('service-worker-exploit-result', false, results.join('\n'));
                    return;
                }
                
                results.push('Service Workers estão disponíveis!');
                
                // Código para o Service Worker
                const swCode = `
                    self.addEventListener('install', event => {
                        console.log('Service Worker instalado');
                        self.skipWaiting();
                    });
                    
                    self.addEventListener('activate', event => {
                        console.log('Service Worker ativado');
                        event.waitUntil(self.clients.claim());
                    });
                    
                    self.addEventListener('fetch', event => {
                        // Intercepta todas as requisições
                        console.log('Requisição interceptada:', event.request.url);
                        
                        // Verifica se é uma requisição para example.com
                        if (event.request.url.includes('example.com')) {
                            // Modifica a resposta
                            event.respondWith(
                                new Response('Resposta modificada pelo Service Worker', {
                                    headers: { 'Content-Type': 'text/plain' }
                                })
                            );
                        }
                    });
                    
                    // Envia mensagem para a página principal
                    self.addEventListener('message', event => {
                        if (event.data === 'getInfo') {
                            event.source.postMessage({
                                type: 'serviceWorkerInfo',
                                scope: self.registration ? self.registration.scope : 'desconhecido',
                                url: self.location.href
                            });
                        }
                    });
                `;
                
                // Cria um Blob com o código do Service Worker
                const blob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);
                
                // Tenta registrar o Service Worker
                navigator.serviceWorker.register(swUrl, { scope: './' })
                    .then(registration => {
                        results.push(`Service Worker registrado com sucesso!`);
                        results.push(`Escopo: ${registration.scope}`);
                        
                        // Espera o Service Worker estar ativo
                        if (registration.active) {
                            communicateWithServiceWorker(registration.active, results);
                        } else {
                            results.push('Aguardando ativação do Service Worker...');
                            registration.onupdatefound = () => {
                                const installingWorker = registration.installing;
                                installingWorker.onstatechange = () => {
                                    if (installingWorker.state === 'activated') {
                                        communicateWithServiceWorker(installingWorker, results);
                                    }
                                };
                            };
                        }
                        
                        displayResult('service-worker-exploit-result', true, results.join('\n'));
                    })
                    .catch(error => {
                        results.push(`Erro ao registrar Service Worker: ${error.message}`);
                        displayResult('service-worker-exploit-result', false, results.join('\n'));
                    });
            } catch (e) {
                displayResult('service-worker-exploit-result', false, `Erro geral: ${e.message}`);
            }
        }

        // Comunicação com o Service Worker
        function communicateWithServiceWorker(worker, results) {
            // Configura o listener para mensagens do Service Worker
            navigator.serviceWorker.addEventListener('message', event => {
                if (event.data.type === 'serviceWorkerInfo') {
                    results.push(`Informações do Service Worker:`);
                    results.push(`- Escopo: ${event.data.scope}`);
                    results.push(`- URL: ${event.data.url}`);
                    
                    displayResult('service-worker-exploit-result', true, results.join('\n'));
                }
            });
            
            // Envia mensagem para o Service Worker
            worker.postMessage('getInfo');
        }

        // Exploração de iframe
        function exploitIframe() {
            try {
                let results = [];
                
                // Cria um iframe
                const iframeContainer = document.getElementById('iframe-container');
                iframeContainer.innerHTML = '';
                
                const iframe = document.createElement('iframe');
                iframe.src = 'about:blank';
                iframe.id = 'test-iframe';
                iframeContainer.appendChild(iframe);
                
                results.push('Iframe criado com sucesso.');
                
                // Tenta acessar o conteúdo do iframe
                try {
                    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                    iframeDoc.body.innerHTML = '<h2>Conteúdo modificado pelo script principal</h2>';
                    results.push('Conseguiu modificar o conteúdo do iframe about:blank.');
                    
                    // Tenta executar script no iframe
                    const script = iframeDoc.createElement('script');
                    script.textContent = 'window.iframeTestVar = "Teste de execução de script no iframe";';
                    iframeDoc.head.appendChild(script);
                    
                    if (iframe.contentWindow.iframeTestVar) {
                        results.push(`Script executado no iframe: ${iframe.contentWindow.iframeTestVar}`);
                    }
                    
                    // Tenta acessar o localStorage do iframe
                    try {
                        iframe.contentWindow.localStorage.setItem('iframeTest', 'valor de teste');
                        const storedValue = iframe.contentWindow.localStorage.getItem('iframeTest');
                        results.push(`Acesso ao localStorage do iframe: ${storedValue}`);
                    } catch (e) {
                        results.push(`Erro ao acessar localStorage do iframe: ${e.message}`);
                    }
                } catch (e) {
                    results.push(`Erro ao acessar conteúdo do iframe: ${e.message}`);
                }
                
                // Tenta criar um iframe apontando para outro domínio
                const crossDomainIframe = document.createElement('iframe');
                crossDomainIframe.src = 'https://example.com';
                crossDomainIframe.id = 'cross-domain-iframe';
                iframeContainer.appendChild(crossDomainIframe);
                
                results.push('Iframe para domínio externo criado.');
                
                // Tenta acessar o conteúdo do iframe de outro domínio (deve falhar devido à política de mesma origem)
                setTimeout(() => {
                    try {
                        const crossDomainDoc = crossDomainIframe.contentDocument || crossDomainIframe.contentWindow.document;
                        results.push(`VULNERABILIDADE: Conseguiu acessar documento de outro domínio!`);
                        displayResult('iframe-exploit-result', true, results.join('\n'));
                    } catch (e) {
                        results.push(`Erro ao acessar conteúdo do iframe de outro domínio (comportamento esperado): ${e.message}`);
                        displayResult('iframe-exploit-result', false, results.join('\n'));
                    }
                }, 1000);
            } catch (e) {
                displayResult('iframe-exploit-result', false, `Erro geral: ${e.message}`);
            }
        }

        // Exploração de WebSocket
        function exploitWebSocket() {
            try {
                let results = [];
                
                // Verifica se WebSocket está disponível
                if (typeof WebSocket === 'undefined') {
                    results.push('WebSocket não está disponível neste navegador.');
                    displayResult('websocket-exploit-result', false, results.join('\n'));
                    return;
                }
                
                results.push('WebSocket está disponível!');
                
                // Tenta conectar a um servidor WebSocket público
                try {
                    results.push('Tentando conectar a um servidor WebSocket público...');
                    const ws = new WebSocket('wss://echo.websocket.org');
                    
                    ws.onopen = function() {
                        results.push('Conexão WebSocket estabelecida com sucesso!');
                        ws.send('Olá, servidor WebSocket!');
                    };
                    
                    ws.onmessage = function(event) {
                        results.push(`Mensagem recebida do servidor: ${event.data}`);
                        ws.close();
                    };
                    
                    ws.onerror = function(error) {
                        results.push(`Erro na conexão WebSocket pública: ${error.message || 'Erro desconhecido'}`);
                    };
                    
                    ws.onclose = function() {
                        results.push('Conexão WebSocket pública fechada.');
                        testLocalWebSocket();
                    };
                } catch (e) {
                    results.push(`Erro ao criar WebSocket público: ${e.message}`);
                    testLocalWebSocket();
                }
                
                // Função para testar WebSocket local
                function testLocalWebSocket() {
                    try {
                        results.push('\nTentando conectar a um servidor WebSocket local...');
                        const localWs = new WebSocket('ws://localhost:8000');
                        
                        localWs.onopen = function() {
                            results.push('VULNERABILIDADE: Conexão WebSocket local estabelecida com sucesso!');
                            localWs.send('Olá, servidor local!');
                            displayResult('websocket-exploit-result', true, results.join('\n'));
                        };
                        
                        localWs.onmessage = function(event) {
                            results.push(`Mensagem recebida do servidor local: ${event.data}`);
                            localWs.close();
                            displayResult('websocket-exploit-result', true, results.join('\n'));
                        };
                        
                        localWs.onerror = function(error) {
                            results.push(`Erro na conexão WebSocket local (comportamento esperado): ${error.message || 'Erro desconhecido'}`);
                            displayResult('websocket-exploit-result', false, results.join('\n'));
                        };
                        
                        localWs.onclose = function() {
                            results.push('Conexão WebSocket local fechada.');
                            displayResult('websocket-exploit-result', false, results.join('\n'));
                        };
                        
                        // Timeout para caso a conexão não seja estabelecida
                        setTimeout(function() {
                            if (localWs.readyState !== WebSocket.OPEN) {
                                results.push('Timeout: Não foi possível estabelecer conexão WebSocket local.');
                                displayResult('websocket-exploit-result', false, results.join('\n'));
                            }
                        }, 3000);
                    } catch (e) {
                        results.push(`Erro ao criar WebSocket local: ${e.message}`);
                        displayResult('websocket-exploit-result', false, results.join('\n'));
                    }
                }
            } catch (e) {
                displayResult('websocket-exploit-result', false, `Erro geral: ${e.message}`);
            }
        }

        // Exploração de armazenamento
        function exploitStorage() {
            try {
                let results = [];
                
                // Testa localStorage
                try {
                    if (typeof localStorage !== 'undefined') {
                        localStorage.setItem('testStorage', 'valor de teste');
                        const storedValue = localStorage.getItem('testStorage');
                        results.push(`localStorage: ${storedValue}`);
                        localStorage.removeItem('testStorage');
                    } else {
                        results.push('localStorage não disponível.');
                    }
                } catch (e) {
                    results.push(`Erro ao acessar localStorage: ${e.message}`);
                }
                
                // Testa sessionStorage
                try {
                    if (typeof sessionStorage !== 'undefined') {
                        sessionStorage.setItem('testSession', 'valor de sessão');
                        const sessionValue = sessionStorage.getItem('testSession');
                        results.push(`sessionStorage: ${sessionValue}`);
                        sessionStorage.removeItem('testSession');
                    } else {
                        results.push('sessionStorage não disponível.');
                    }
                } catch (e) {
                    results.push(`Erro ao acessar sessionStorage: ${e.message}`);
                }
                
                // Testa IndexedDB
                try {
                    if (typeof indexedDB !== 'undefined') {
                        const request = indexedDB.open('testDB', 1);
                        
                        request.onupgradeneeded = function(event) {
                            const db = event.target.result;
                            const objectStore = db.createObjectStore('testStore', { keyPath: 'id' });
                        };
                        
                        request.onsuccess = function(event) {
                            const db = event.target.result;
                            results.push('IndexedDB aberto com sucesso.');
                            
                            // Adiciona dados
                            const transaction = db.transaction(['testStore'], 'readwrite');
                            const objectStore = transaction.objectStore('testStore');
                            const testObject = { id: 1, name: 'Teste', value: 'Dados de teste' };
                            
                            const addRequest = objectStore.add(testObject);
                            addRequest.onsuccess = function() {
                                results.push('Dados adicionados ao IndexedDB.');
                                
                                // Lê os dados
                                const getRequest = objectStore.get(1);
                                getRequest.onsuccess = function() {
                                    results.push(`IndexedDB: ${JSON.stringify(getRequest.result)}`);
                                    
                                    // Fecha e exclui o banco de dados
                                    db.close();
                                    indexedDB.deleteDatabase('testDB');
                                    
                                    displayResult('storage-exploit-result', false, results.join('\n'));
                                };
                            };
                        };
                        
                        request.onerror = function(event) {
                            results.push(`Erro ao abrir IndexedDB: ${event.target.error}`);
                            displayResult('storage-exploit-result', false, results.join('\n'));
                        };
                    } else {
                        results.push('IndexedDB não disponível.');
                        displayResult('storage-exploit-result', false, results.join('\n'));
                    }
                } catch (e) {
                    results.push(`Erro ao acessar IndexedDB: ${e.message}`);
                    displayResult('storage-exploit-result', false, results.join('\n'));
                }
            } catch (e) {
                displayResult('storage-exploit-result', false, `Erro geral: ${e.message}`);
            }
        }

        // Execução de código personalizado
        function executeCustomCode() {
            try {
                const codeElement = document.getElementById('custom-code');
                const code = codeElement.value;
                
                let results = [];
                results.push('Executando código personalizado:');
                results.push(`\n${code}\n`);
                
                // Captura console.log
                const originalConsoleLog = console.log;
                const logs = [];
                
                console.log = function() {
                    logs.push(Array.from(arguments).join(' '));
                    originalConsoleLog.apply(console, arguments);
                };
                
                // Executa o código
                try {
                    const result = eval(code);
                    results.push('Resultado:');
                    results.push(result !== undefined ? result.toString() : 'undefined');
                    
                    if (logs.length > 0) {
                        results.push('\nLogs:');
                        logs.forEach(log => results.push(log));
                    }
                    
                    // Verifica se o código conseguiu acessar algo privilegiado
                    if (code.includes('window.top') || code.includes('window.parent')) {
                        if (result && typeof result === 'string' && result.includes('http')) {
                            displayResult('custom-code-result', true, results.join('\n'));
                        } else {
                            displayResult('custom-code-result', false, results.join('\n'));
                        }
                    } else {
                        displayResult('custom-code-result', false, results.join('\n'));
                    }
                } catch (e) {
                    results.push(`Erro: ${e.message}`);
                    displayResult('custom-code-result', false, results.join('\n'));
                }
                
                // Restaura console.log
                console.log = originalConsoleLog;
            } catch (e) {
                displayResult('custom-code-result', false, `Erro geral: ${e.message}`);
            }
        }

        // Exploração de prototype
        function exploitPrototype() {
            try {
                let results = [];
                
                // Tenta modificar o prototype de Object
                try {
                    const originalToString = Object.prototype.toString;
                    
                    Object.prototype.toString = function() {
                        if (this === window) {
                            return '[object Window]';
                        }
                        return originalToString.call(this);
                    };
                    
                    results.push('Prototype de Object.toString modificado com sucesso.');
                    
                    // Restaura o método original
                    Object.prototype.toString = originalToString;
                } catch (e) {
                    results.push(`Erro ao modificar prototype de Object: ${e.message}`);
                }
                
                // Tenta modificar o prototype de Function
                try {
                    const originalFunctionToString = Function.prototype.toString;
                    
                    Function.prototype.toString = function() {
                        if (this === Function.prototype.toString) {
                            return 'function toString() { [native code] }';
                        }
                        return originalFunctionToString.call(this);
                    };
                    
                    results.push('Prototype de Function.toString modificado com sucesso.');
                    
                    // Restaura o método original
                    Function.prototype.toString = originalFunctionToString;
                } catch (e) {
                    results.push(`Erro ao modificar prototype de Function: ${e.message}`);
                }
                
                // Tenta adicionar um método ao prototype de String
                try {
                    if (!String.prototype.exploitTest) {
                        String.prototype.exploitTest = function() {
                            return this + ' (modificado)';
                        };
                        
                        const testString = 'Teste';
                        results.push(`String.prototype modificado: ${testString.exploitTest()}`);
                        
                        // Remove o método adicionado
                        delete String.prototype.exploitTest;
                    }
                } catch (e) {
                    results.push(`Erro ao modificar prototype de String: ${e.message}`);
                }
                
                // Verifica se conseguiu modificar algum prototype
                if (results.some(r => r.includes('modificado com sucesso'))) {
                    displayResult('prototype-exploit-result', true, results.join('\n'));
                } else {
                    displayResult('prototype-exploit-result', false, results.join('\n'));
                }
            } catch (e) {
                displayResult('prototype-exploit-result', false, `Erro geral: ${e.message}`);
            }
        }

        // Exploração de eval
        function exploitEval() {
            try {
                let results = [];
                
                // Verifica se eval está disponível
                if (typeof eval !== 'function') {
                    results.push('eval não está disponível neste contexto.');
                    displayResult('eval-exploit-result', false, results.join('\n'));
                    return;
                }
                
                results.push('eval está disponível!');
                
                // Tenta usar eval para acessar o objeto window
                try {
                    const windowProps = eval('Object.keys(window).length');
                    results.push(`Número de propriedades em window: ${windowProps}`);
                } catch (e) {
                    results.push(`Erro ao acessar window via eval: ${e.message}`);
                }
                
                // Tenta usar eval para acessar o DOM
                try {
                    const docTitle = eval('document.title');
                    results.push(`Título do documento: ${docTitle}`);
                } catch (e) {
                    results.push(`Erro ao acessar document via eval: ${e.message}`);
                }
                
                // Tenta usar eval para acessar o objeto parent
                try {
                    const hasParent = eval('window.parent !== window');
                    results.push(`window.parent !== window: ${hasParent}`);
                    
                    if (hasParent) {
                        try {
                            const parentTitle = eval('window.parent.document.title');
                            results.push(`VULNERABILIDADE: Título do documento pai: ${parentTitle}`);
                            displayResult('eval-exploit-result', true, results.join('\n'));
                            return;
                        } catch (e) {
                            results.push(`Erro ao acessar document do pai via eval: ${e.message}`);
                        }
                    }
                } catch (e) {
                    results.push(`Erro ao verificar parent via eval: ${e.message}`);
                }
                
                // Tenta usar eval com Function constructor
                try {
                    const indirectEval = Function('return window.location.href')();
                    results.push(`Resultado de Function constructor: ${indirectEval}`);
                } catch (e) {
                    results.push(`Erro ao usar Function constructor: ${e.message}`);
                }
                
                displayResult('eval-exploit-result', false, results.join('\n'));
            } catch (e) {
                displayResult('eval-exploit-result', false, `Erro geral: ${e.message}`);
            }
        }
    </script>
</body>
</html>
