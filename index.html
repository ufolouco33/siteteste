<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Testes de Seguran√ßa Abrangentes do Console - Por Desenvolvedor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f0f0f0;
            color: #333;
        }
        .container {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #0056b3;
        }
        button {
            padding: 10px 15px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            background-color: #007bff;
            color: white;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #0056b3;
        }
        input[type="text"] {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: calc(70% - 10px); /* Ajuste para espa√ßamento */
            box-sizing: border-box;
        }
        textarea {
            width: 98%;
            height: 100px;
            margin-top: 10px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        pre {
            background-color: #e2e2e2;
            padding: 10px;
            border-radius: 5px;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 200px;
            overflow-y: auto;
        }
        .result {
            margin-top: 10px;
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .error-message {
            color: red;
            font-weight: bold;
        }
        .success-message {
            color: green;
            font-weight: bold;
        }
        canvas {
            display: block;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üõ†Ô∏è Testes de Seguran√ßa do Navegador do Console üõ†Ô∏è</h1>
        <p>Esta p√°gina cont√©m scripts JavaScript para simular v√°rias condi√ß√µes de teste no navegador do seu console. Observe o comportamento e as mensagens de log abaixo.</p>

        ---

        <h2>1. Teste de Inje√ß√£o de Conte√∫do (XSS B√°sico)</h2>
        <p>Tente injetar tags HTML/Script na caixa de texto. Elas devem ser sanitizadas ou exibidas como texto puro.</p>
        <input type="text" id="userInput" placeholder='Ex: <script>alert("XSS!");</script>'>
        <button onclick="displayInput()">Exibir Entrada</button>
        <div id="outputArea" class="result">Conte√∫do:</div>

        ---

        <h2>2. Teste de Loop Infinito (Potencial Congelamento)</h2>
        <p>Este teste tenta iniciar um loop que consome CPU. Navegadores modernos deveriam detect√°-lo e alertar ou travar apenas a aba.</p>
        <button onclick="startInfiniteLoop()">Iniciar Loop Infinito</button>
        <div id="loopStatus" class="result">Status do Loop: Aguardando...</div>

        ---

        <h2>3. Teste de Aloca√ß√£o de Mem√≥ria</h2>
        <p>Este teste tenta alocar uma grande quantidade de mem√≥ria (100MB por clique).</p>
        <button onclick="allocateMemory()">Alocar 100MB de Mem√≥ria</button>
        <div id="memoryStatus" class="result">Mem√≥ria Alocada: 0 MB</div>

        ---

        <h2>4. Tentativa de Acesso a APIs Restritas</h2>
        <p>Este teste tenta acessar APIs que o JavaScript de uma p√°gina web n√£o deveria ter permiss√£o para acessar (ex: sistema de arquivos local).</p>
        <button onclick="testRestrictedAPI()">Testar Acesso Restrito</button>
        <div id="apiStatus" class="result">Status da API: Aguardando...</div>

        ---

        <h2>5. Teste de Redirecionamento Infinito</h2>
        <p>Este teste tenta redirecionar a p√°gina para si mesma infinitamente. Navegadores deveriam detectar e parar.</p>
        <button onclick="startInfiniteRedirect()">Iniciar Redirecionamento Infinito</button>
        <div id="redirectStatus" class="result">Status do Redirecionamento: Aguardando...</div>

        ---

        <h2>6. Teste de Manipula√ß√£o de Cookies e Local Storage</h2>
        <p>Verifica se cookies e localStorage podem ser definidos e lidos pela mesma origem. N√£o deve vazar informa√ß√µes.</p>
        <button onclick="testCookieLocalStorage()">Testar Cookies/Local Storage</button>
        <div id="cookieStorageStatus" class="result">Status: Aguardando...</div>

        ---

        <h2>7. Teste de Conex√µes WebSocket para Portas/IPs Incomuns</h2>
        <p>Tenta abrir WebSockets para portas e IPs que n√£o deveriam ser acess√≠veis (ex: portas de servi√ßo internas, localhost).</p>
        <input type="text" id="wsUrl" value="ws://localhost:8080" placeholder="Ex: ws://127.0.0.1:8080">
        <button onclick="testWebSocket()">Conectar WebSocket</button>
        <div id="wsStatus" class="result">Status: Aguardando...</div>

        ---

        <h2>8. Teste de Carregamento de Recurso Cross-Origin (CORS)</h2>
        <p>Tenta carregar uma imagem de um dom√≠nio externo que pode ter pol√≠ticas CORS restritivas ou que n√£o existe.</p>
        <input type="text" id="imageUrl" value="https://this-domain-should-not-exist-12345.com/nonexistent.png" placeholder="Ex: https://example.com/image.png">
        <button onclick="testCORSImage()">Carregar Imagem CORS</button>
        <div id="corsStatus" class="result">Status: Aguardando...</div>
        <div id="corsImageContainer"></div>

        ---

        <h2>9. Teste de Estresse Gr√°fico (Canvas Animado)</h2>
        <p>Desenha anima√ß√µes complexas em um canvas para estressar o motor de renderiza√ß√£o do navegador.</p>
        <button onclick="startGraphicsStress()">Iniciar Estresse Gr√°fico</button>
        <button onclick="stopGraphicsStress()">Parar Estresse Gr√°fico</button>
        <canvas id="graphicsCanvas" width="400" height="200" style="border: 1px solid black; background-color: #eee;"></canvas>
        <div id="graphicsStatus" class="result">Status: Inativo</div>

        ---

        <h2>Resultados do Console (Log):</h2>
        <pre id="consoleLog"></pre>
    </div>

    <script>
        const consoleLogElement = document.getElementById('consoleLog');
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            let color = 'black';
            if (type === 'error') color = 'red';
            if (type === 'success') color = 'green';
            consoleLogElement.innerHTML += `<span style="color: ${color};">[${timestamp}] ${message}</span>\n`;
            consoleLogElement.scrollTop = consoleLogElement.scrollHeight; // Auto-scroll
        }

        let allocatedBlocks = [];
        let totalAllocatedMB = 0;

        // --- Teste 1: Inje√ß√£o de Conte√∫do (XSS B√°sico) ---
        function displayInput() {
            const userInput = document.getElementById('userInput').value;
            const outputArea = document.getElementById('outputArea');
            log(`Teste XSS: Entrada bruta: "${userInput}"`, 'info');

            // Forma segura (deve ser a pr√°tica do seu navegador)
            const safeText = document.createTextNode(userInput);
            outputArea.textContent = 'Conte√∫do: '; // Limpa antes
            outputArea.appendChild(safeText); // Adiciona o texto de forma segura

            log('Teste XSS: Conte√∫do exibido. Verifique se scripts ou tags HTML foram renderizados. Idealmente, N√ÉO devem ser.', 'success');
        }

        // --- Teste 2: Loop Infinito ---
        function startInfiniteLoop() {
            const loopStatus = document.getElementById('loopStatus');
            log('Teste Loop: Iniciando loop infinito...', 'info');
            loopStatus.textContent = 'Status do Loop: Rodando... (Aguardando congelamento ou aviso)';
            let i = 0;
            try {
                const startTime = Date.now();
                // Tenta rodar por 5 segundos intensamente para simular carga de CPU
                while (Date.now() - startTime < 5000) {
                    i++;
                    if (i % 1000000 === 0) {
                        console.log(`Loop itera√ß√£o: ${i}`);
                    }
                }
                log('Teste Loop: Loop terminado (normalmente, o navegador deveria intervir se fosse um loop real).', 'success');
                loopStatus.textContent = 'Status do Loop: Terminado. (Se seu console travou, isso √© um sinal)';
            } catch (e) {
                log(`Teste Loop: Erro durante o loop: ${e.message}. Isso pode ser uma prote√ß√£o do navegador.`, 'error');
                loopStatus.textContent = `Status do Loop: Interrompido por erro ou prote√ß√£o: ${e.message}`;
            }
        }

        // --- Teste 3: Aloca√ß√£o de Mem√≥ria ---
        function allocateMemory() {
            const memoryStatus = document.getElementById('memoryStatus');
            const blockSizeMB = 100; // Alocar 100 MB por vez
            const blockSizeBytes = blockSizeMB * 1024 * 1024; // Converter para bytes

            try {
                const newBlock = new Uint8Array(blockSizeBytes);
                allocatedBlocks.push(newBlock);
                totalAllocatedMB += blockSizeMB;
                memoryStatus.textContent = `Mem√≥ria Alocada: ${totalAllocatedMB} MB`;
                log(`Teste Mem√≥ria: Alocados ${blockSizeMB} MB. Total: ${totalAllocatedMB} MB.`, 'info');
            } catch (e) {
                log(`Teste Mem√≥ria: Falha ao alocar mem√≥ria: ${e.message}. Mem√≥ria pode estar cheia ou navegador limitando.`, 'error');
                memoryStatus.textContent = `Mem√≥ria Alocada: ${totalAllocatedMB} MB (Falha ao alocar mais)`;
                alert(`Erro de mem√≥ria: ${e.message}. O navegador ou console pode estar com pouca mem√≥ria ou limitando a aloca√ß√£o.`);
            }
        }

        // --- Teste 4: Tentativa de Acesso a APIs Restritas ---
        function testRestrictedAPI() {
            const apiStatus = document.getElementById('apiStatus');
            log('Teste API Restrita: Tentando acessar APIs restritas (ex: sistema de arquivos)...', 'info');

            let results = [];

            // Tentativa 1: Acesso ao sistema de arquivos (File System API - n√£o deve funcionar em p√°ginas comuns)
            try {
                if ('requestFileSystem' in window) {
                    window.requestFileSystem(window.TEMPORARY, 1024 * 1024, function(fs) {
                        results.push("FileSystem API: Acesso TEMPORARY concedido (Inesperado para p√°ginas web comuns).");
                        log('Teste API Restrita: FileSystem API acess√≠vel. Isso √© INCOMUM para p√°ginas web.', 'error');
                    }, function(e) {
                        results.push(`FileSystem API: Erro de acesso (Esperado): ${e.message}`);
                        log(`Teste API Restrita: FileSystem API erro (esperado): ${e.message}`, 'success');
                    });
                } else {
                    results.push("FileSystem API: N√£o suportada neste navegador.");
                    log('Teste API Restrita: FileSystem API n√£o suportada.', 'info');
                }
            } catch (e) {
                results.push(`FileSystem API: Erro inesperado: ${e.message}`);
                log(`Teste API Restrita: FileSystem API erro inesperado: ${e.message}`, 'error');
            }

            // Tentativa 2: Acessar algo como um objeto global de sistema (exemplo hipot√©tico)
            try {
                if (window.SystemAccess || window.KernelAPI) { // Nomes hipot√©ticos
                    results.push("Objeto de sistema encontrado! Isso √© uma falha grave.");
                    log('Teste API Restrita: Objeto de sistema inesperado encontrado! FALHA GRAVE!', 'error');
                } else {
                    results.push("Nenhum objeto de sistema detectado (Esperado).");
                    log('Teste API Restrita: Nenhum objeto de sistema detectado (esperado).', 'success');
                }
            } catch (e) {
                results.push(`Acesso a objeto de sistema: Erro: ${e.message}`);
                log(`Teste API Restrita: Erro ao tentar acessar objeto de sistema: ${e.message}`, 'error');
            }

            apiStatus.innerHTML = `Status da API: <pre>${results.join('\n')}</pre>`;
        }

        // --- Teste 5: Redirecionamento Infinito ---
        function startInfiniteRedirect() {
            const redirectStatus = document.getElementById('redirectStatus');
            log('Teste Redirecionamento: Tentando redirecionamento infinito...', 'info');
            redirectStatus.textContent = 'Status do Redirecionamento: Redirecionando...';
            setTimeout(() => {
                window.location.href = window.location.href; // Redireciona para a pr√≥pria p√°gina
            }, 100);
        }

        // --- Teste 6: Manipula√ß√£o de Cookies e Local Storage ---
        function testCookieLocalStorage() {
            const cookieStorageStatus = document.getElementById('cookieStorageStatus');
            log('Teste Cookie/Storage: Tentando definir e ler cookies e localStorage...', 'info');
            let successCount = 0;
            let failureCount = 0;
            let results = [];

            // Testar Cookies
            try {
                document.cookie = "testCookie=consoleTest; expires=" + new Date(Date.now() + 3600 * 1000).toUTCString();
                const readCookie = document.cookie;
                if (readCookie.includes("testCookie=consoleTest")) {
                    results.push("Cookie: Definido e lido com sucesso.");
                    successCount++;
                } else {
                    results.push("Cookie: Falha ao definir ou ler.");
                    failureCount++;
                }
            } catch (e) {
                results.push(`Cookie: Erro: ${e.message}`);
                failureCount++;
            }

            // Testar Local Storage
            try {
                localStorage.setItem("testLocalStorage", "consoleLocalStorageTest");
                const readLocalStorage = localStorage.getItem("testLocalStorage");
                if (readLocalStorage === "consoleLocalStorageTest") {
                    results.push("Local Storage: Definido e lido com sucesso.");
                    successCount++;
                } else {
                    results.push("Local Storage: Falha ao definir ou ler.");
                    failureCount++;
                }
                localStorage.removeItem("testLocalStorage"); // Limpa
            } catch (e) {
                results.push(`Local Storage: Erro: ${e.message}`);
                failureCount++;
            }

            cookieStorageStatus.innerHTML = `Status: <pre>${results.join('\n')}</pre>`;
            if (successCount > 0 && failureCount === 0) {
                log('Teste Cookie/Storage: Conclu√≠do. Comportamento esperado (funcionalidade b√°sica de armazenamento).', 'success');
            } else {
                log('Teste Cookie/Storage: Conclu√≠do com falhas. Investigar se h√° problemas de permiss√£o ou sandbox.', 'error');
            }
        }

        // --- Teste 7: Conex√µes WebSocket para Portas/IPs Incomuns ---
        function testWebSocket() {
            const wsUrlInput = document.getElementById('wsUrl').value;
            const wsStatus = document.getElementById('wsStatus');
            log(`Teste WebSocket: Tentando conectar a ${wsUrlInput}...`, 'info');
            wsStatus.textContent = `Status: Conectando a ${wsUrlInput}...`;

            try {
                const ws = new WebSocket(wsUrlInput);

                ws.onopen = () => {
                    wsStatus.textContent = `Status: Conectado com sucesso a ${wsUrlInput}. Isso pode ser um problema de seguran√ßa se for um IP/porta interna.`;
                    log(`Teste WebSocket: Conex√£o WebSocket aberta com ${wsUrlInput}. MUITA ATEN√á√ÉO se essa URL √© interna!`, 'error');
                    ws.close();
                };

                ws.onmessage = (event) => {
                    wsStatus.textContent = `Status: Mensagem recebida: ${event.data}`;
                    log(`Teste WebSocket: Mensagem recebida: ${event.data}`, 'info');
                };

                ws.onerror = (error) => {
                    wsStatus.textContent = `Status: Erro na conex√£o com ${wsUrlInput}. (Esperado se a porta/IP n√£o for p√∫blica ou segura)`;
                    log(`Teste WebSocket: Erro na conex√£o: ${error.message || 'Desconhecido'}. (Comportamento esperado para IPs/portas internas ou n√£o autorizadas)`, 'success');
                };

                ws.onclose = () => {
                    log(`Teste WebSocket: Conex√£o fechada com ${wsUrlInput}.`, 'info');
                };

            } catch (e) {
                wsStatus.textContent = `Status: Falha ao iniciar WebSocket: ${e.message}.`;
                log(`Teste WebSocket: Erro ao iniciar WebSocket: ${e.message}. (Geralmente indica que a URL n√£o √© v√°lida ou √© bloqueada)`, 'error');
            }
        }

        // --- Teste 8: Teste de Carregamento de Recurso Cross-Origin (CORS) ---
        function testCORSImage() {
            const imageUrl = document.getElementById('imageUrl').value;
            const corsStatus = document.getElementById('corsStatus');
            const corsImageContainer = document.getElementById('corsImageContainer');
            corsImageContainer.innerHTML = ''; // Limpa qualquer imagem anterior

            log(`Teste CORS: Tentando carregar imagem de ${imageUrl}...`, 'info');
            corsStatus.textContent = `Status: Carregando ${imageUrl}...`;

            const img = new Image();
            img.onload = () => {
                corsStatus.textContent = `Status: Imagem carregada com sucesso de ${imageUrl}. (Verificar se √© uma imagem conhecida e esperada)`;
                corsImageContainer.appendChild(img);
                log(`Teste CORS: Imagem carregada com sucesso. Isso √© esperado se o dom√≠nio de origem permitir.`, 'success');
            };
            img.onerror = () => {
                corsStatus.textContent = `Status: Falha ao carregar imagem de ${imageUrl}. (Esperado para dom√≠nios inexistentes ou com CORS restritivo)`;
                log(`Teste CORS: Falha ao carregar imagem. Isso √© um bom sinal se o dom√≠nio for desconhecido ou restrito.`, 'success');
            };
            img.src = imageUrl;
        }

        // --- Teste 9: Teste de Estresse Gr√°fico (Canvas Animado) ---
        let animationFrameId;
        let isGraphicsStressRunning = false;
        function startGraphicsStress() {
            if (isGraphicsStressRunning) return;
            isGraphicsStressRunning = true;

            const canvas = document.getElementById('graphicsCanvas');
            const ctx = canvas.getContext('2d');
            const graphicsStatus = document.getElementById('graphicsStatus');
            log('Teste Gr√°fico: Iniciando estresse gr√°fico...', 'info');
            graphicsStatus.textContent = 'Status: Rodando... (Observar desempenho e estabilidade)';

            let angle = 0;
            const draw = () => {
                ctx.clearRect(0, 0, canvas.width, canvas.height); // Limpa o canvas

                // Desenha c√≠rculos em movimento
                for (let i = 0; i < 50; i++) {
                    const x = canvas.width / 2 + Math.cos(angle + i * 0.1) * (100 + i * 0.5);
                    const y = canvas.height / 2 + Math.sin(angle + i * 0.1) * (50 + i * 0.2);
                    const radius = 5 + Math.sin(angle * 0.5 + i * 0.2) * 3;

                    ctx.beginPath();
                    ctx.arc(x, y, radius, 0, Math.PI * 2);
                    ctx.fillStyle = `hsl(${angle * 10 % 360}, 70%, 50%)`;
                    ctx.fill();
                }

                angle += 0.05; // Velocidade da anima√ß√£o
                animationFrameId = requestAnimationFrame(draw); // Solicita o pr√≥ximo frame
            };

            animationFrameId = requestAnimationFrame(draw);
        }

        function stopGraphicsStress() {
            if (!isGraphicsStressRunning) return;
            isGraphicsStressRunning = false;
            cancelAnimationFrame(animationFrameId);
            document.getElementById('graphicsStatus').textContent = 'Status: Inativo';
            log('Teste Gr√°fico: Estresse gr√°fico parado.', 'info');
        }
    </script>
</body>
</html>
